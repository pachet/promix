(function(t,e,n){function r(n,s){if(!e[n]){if(!t[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(i)return i(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=e[n]={exports:{}};t[n][0].call(u.exports,function(e){var i=t[n][1][e];return r(i?i:e)},u,u.exports)}return e[n].exports}var i=typeof require=="function"&&require;for(var s=0;s<n.length;s++)r(n[s]);return r})({1:[function(t,e,n){var r=t("./lib/Chain"),i=t("./lib/Promise"),s=t("./lib/Handler"),o=t("./lib/Types");function u(){var t=new r,e=Array.prototype.slice.call(arguments);if(e.length){t.and.apply(t,e)}return t}e.exports=o;e.exports.handle=s.set;e.exports.promise=i;e.exports.when=u;e.exports.chain=u;if(typeof window!=="undefined"&&typeof window.promix==="undefined"){window.promix=e.exports}},{"./lib/Chain":2,"./lib/Promise":3,"./lib/Handler":4,"./lib/Types":5}],4:[function(t,e,n){var r={set:function i(t){this.handle=t},handle:null};e.exports=r},{}],2:[function(t,e,n){var r=t("./Promise"),i=t("./Step"),s=t("./Reflector"),o=t("./Handler"),u=t("./Utility");function l(){var t=this;this.time=0;this.steps=[];this.results=[];this.aliases={};this.alternate=false;this.stopped=false;this.silenced=false;this.rejected=false;this.endpoint=false;this.broken=false;this.slice=0;this.suppressed=0;this.position=0;this.focus=-1;this.introspects=0;this.name="none set";this.exports={and:function e(){t.add_promise.apply(t,Array.prototype.slice.call(arguments));if(t.focus===t.position){t.queue(t.steps[t.focus])}return t.exports},or:function n(){t.alternate=true;t.add_promise.apply(t,Array.prototype.slice.call(arguments));t.alternate=false;if(t.focus===t.position&&!t.stopped){t.queue(t.steps[t.focus])}return t.exports},name:function r(e){t.name=e;return t.exports},as:function s(e){t.label(t.focus,e);return t.exports},then:function o(e,n){var r;if(u.check_step(t.steps[t.focus])===false){t.add_step()}r=t.steps[t.focus];if(typeof n==="undefined"){r.then=e}else{t.add_promise.apply(t,Array.prototype.slice.call(arguments))}r.endpoint=t.endpoint;t.endpoint=false;if(t.focus===t.position){t.queue(r)}return t.exports},assert:function l(e){if(u.check_step(t.steps[t.focus])===false){t.add_step()}t.steps[t.focus].assertion=e;return t.exports},otherwise:function f(e){t.steps[t.focus].handler=e;return t.exports},suppress:function a(e){t.suppress(e,true);return t.exports},unsuppress:function a(e){t.suppress(e,false);return t.exports},reject:function p(e){t.reject(e,t.position);return t.exports},callback:function c(e){t.exports.otherwise(e);t.exports.then(function(t){return void e(null,t)});return t.exports},end:function h(){t.endpoint=true;t.exports.then.apply(t.exports,Array.prototype.slice.call(arguments));return t.exports},stop:function d(){t.stopped=true;return t.exports},start:function y(){if(t.stopped){t.stopped=false;t.start()}return t.exports},"break":function m(){t.broken=true;return t.exports},bind:function g(e){t.bind(t.focus,e);return t.exports},until:function b(e){t.steps[t.focus].condition=true;t.steps[t.focus].condition_value=e;return t.exports},time:function v(e){var n,r,s;if(typeof e!=="undefined"){if(typeof t.aliases[e]!=="undefined"){n=t.aliases[e];if(n.constructor===i){return u.find_max_time(n)}else{return u.get_item_time(n)}}else{return null}}else{r=t.position;s=0;while(r--){s+=u.find_max_time(t.steps[r])}return s}},results:this.results,result:this.results};this.add_step();if(arguments.length){this.add_promise.apply(this,Array.prototype.slice.call(arguments))}return this.exports}l.prototype={start:function f(){var t=this.steps[this.position];if(!t.completed&&this.broken===false){this.queue(t)}},queue:function a(t){clearTimeout(t.dispatch_timer);t.dispatch_timer=setTimeout(function e(){this.dispatch_step(t)}.bind(this),0)},bind:function p(t,e){var n=this.steps[t],r,i,s,o;if(!n||n.completed===true){return}r=n.length;while(r--){i=n[r];s=i.length;while(s--){o=i[s];o.context=e}}},suppress:function c(t,e){switch(typeof t){case"undefined":this.suppressed=e;break;case"number":if(t){this.suppressed=t}break;case"string":if(typeof this.aliases[t]!=="undefined"){this.aliases[t].suppressed=e}break}},reject:function h(t,e){var n,r=e;if(this.rejected||this.suppressed){if(o.handle){o.handle(t)}return}n=this.steps.length;this.rejected=true;while(e<n){if(this.steps[e]&&this.steps[e].handler!==null){this.steps[e].handler(t);return}e++}e=r;while(e--){if(this.steps[e]&&this.steps[e].handler!==null){this.steps[e].handler(t);return}}if(this.silenced===false){if(o.handle){return void o.handle(t)}else{throw t}}},complete:function d(t){var e,n,r=0,i=t.length,s,o=this.focus,l,f;if(this.rejected||this.broken){return}t.complete=true;this.focus=this.position;if(i>0){while(r<i){s=u.get_slice_result(t[r]);this.results.push(s);if(typeof t[r].labels!=="undefined"){n=t[r].labels.slice(0);while(n.length){this.results[n.shift()]=s;if(t.condition&&s===t.condition_value){f=true}}}r++}}else if(typeof t.assertion==="function"&&t.assertion(this.results)===false){if(typeof t.label!=="undefined"){e=t.label}else{e=t.assertion.toString()}return void this.reject(new Error("Domain failed assertion: "+e),this.position-1)}else if(typeof t.then==="function"){l=t.then(this.results);if(typeof l!=="undefined"){t.then=null;this.add_promise(l);if(typeof t.label!=="undefined"){this.label(this.focus,t.label)}this.position--;o--}}if(f||!t.condition){this.position++}else if(t.condition_value&&typeof t.condition_value.then==="function"&&t.condition_bound===false){t.condition_bound=true;t.condition_value.then(function a(e){t.condition=false},this.exports.break)}if(this.position<this.steps.length){return void this.dispatch_step(this.steps[this.position])}},dispatch_step:function y(t){var e=t.length,n=0,r,i=this.focus,s=this.complete.bind(this);this.focus=this.position;if(this.stopped===true||this.rejected===true){return}if(e){this.slice=0;while(this.slice<e){n=0;r=t[this.slice].length;while(n<r){this.apply_hooks.apply(this,[].concat(t[this.slice][n]));n++}this.slice++}}else{setTimeout(function(){return void s(t)},0)}this.focus=i},add_step:function m(){var t=new i;this.steps.splice(++this.focus,0,t);return t},apply_hooks:function g(t){var e=this.focus,n=this.steps[e],i=this.slice,s,o,u,f,a,p,c,h=this,d=this.name,y=this.steps,m=null;function g(e){t.finish=Date.now();n.complete_count++;if(n.complete_count>=n.length){return void h.complete(n)}}function b(n){t.finish=Date.now();if(t.parent.suppressed||h.suppressed){if(!t.parent.suppressed&&typeof h.suppressed==="number"){h.suppressed--}return void g(null)}return void h.reject(n,e-1)}if(t.arguments){m=t.arguments[0]}if(typeof m==="function"){m=Array.prototype.slice.call(t.arguments)}if(Object.prototype.toString.call(m)==="[object Array]"){o=1;while(o<m.length){u=m[o];if(u&&typeof u.then==="function"){o=1;a=new l;while(o<m.length){a.and(m[o]);o++}c=m[0];a.then(function v(e){var r=[c].concat(e);if(n.endpoint){a.end.apply(a,r)}else{a.then.apply(a,r).as("introspect")}if(t.context){a.bind(t.context)}});a.then(function S(e){return void t.fulfill(e.introspect)});a.otherwise(t.reject);break}o++}if(!a){f=t.arguments.slice(0);m=f.shift();if(n.condition){t=new r(t);n.complete_count=0}if(typeof m==="function"){if(!n.endpoint){f.push(function w(e,n){if(e){return void t.reject(e)}else{return void t.fulfill(n)}})}setTimeout(function x(){return void m.apply(t.context||null,f)},0)}else{setTimeout(function N(){if(f.length){return void t.fulfill([m].concat(f))}else{return void t.fulfill(m)}},0)}}}else if((!m||typeof m.then!=="function")&&this.strict){s=m;setTimeout(function j(){var n="";if(y[e][i]&&y[e][i].labels){n=' (labelled "'+y[e][i].labels[0]+'")'}return void t.reject(new Error('The domain (named "'+d+'") was given an invalid promise'+n+": "+s))},0)}if(t.constructor===l){t.then(g).otherwise(b)}else{t.then(g,b)}t.start=Date.now()},add_promise:function b(t,e){var n,i,s=Array.prototype.slice.call(arguments);if(typeof t.then==="function"){n=t}else{n=new r;if(s.length===1&&typeof t!=="function"){setTimeout(function o(){return void n.fulfill(t)},0)}else{n.arguments=s}}i=this.steps[this.focus];if(i.assertion!==null||i.then!==null){i=this.add_step()}this.slice=i.length-1;if(this.alternate&&this.slice+1){i[this.slice].push(n);n.parent=i[this.slice]}else{n.parent=[n];this.slice=i.push(n.parent)}},label:function v(t,e){var n;if(this.steps.length<t){return}n=this.steps[t];if(n.length===0){n.label=e;this.aliases[e]=n}else{n=n[n.length-1];if(typeof n.labels==="undefined"){n.labels=[]}n.labels.push(e);this.aliases[e]=n;if(this.reserved_identifiers.indexOf(e)===-1){this.exports[e]=new s(n[n.length-1])}}}};l.prototype.reserved_identifiers=Object.keys(l.prototype);e.exports=l},{"./Promise":3,"./Step":6,"./Reflector":7,"./Handler":4,"./Utility":8}],3:[function(t,e,n){var r=t("./Handler");function i(t){var e=[],n=[],s=false,o=false,u=null,l=null,f=null,a;function p(t){if(o){throw new Error("Cannot fulfill a rejected promise")}a.fulfilled=s=true;a.result=u=t;while(e.length){e.shift()(u)}}function c(t){var e=false;if(s){throw new Error("Cannot reject a fulfilled promise")}a.rejected=o=true;a.error=l=t;while(n.length){n.shift()(l);e=true}if(!e){if(r.handle){r.handle(l)}}}function h(t,r){if(s){setTimeout(function a(){return void t(u)},0)}else if(o&&typeof r==="function"){setTimeout(function p(){return void r(l)},0)}else{e.push(t);if(typeof r==="function"){n.push(r)}}if(f===null){f=new i;h(f.fulfill,f.reject)}return f}a=t||{};a.reject=c;a.fulfill=p;a.then=h;a.result=null;a.error=null;a.fulfilled=false;a.rejected=false;return a}e.exports=i},{"./Handler":4}],5:[function(t,e,n){var r=t("./Promise"),i=t("./Chain"),s,o,u,l,f,a,p,c,h={},d={},y,m;function g(t){var e=new r(new d["String"]);e.valueOf=u.String.valueOf;setTimeout(function(){if(t&&typeof t.then==="function"){t.then(e.fulfill,e.reject)}else{e.fulfill(t)}},0);return e}function b(t){var e=new r(new d["Array"]),n=new i,s=Array.prototype.slice.call(arguments);e.valueOf=u.Array.valueOf;function o(){return void e.fulfill.apply(e,Array.prototype.slice.call(arguments))}s.unshift(o);n.end.apply(n,s);n.otherwise(e.reject);return e}function v(t){var e=new r(new d["Number"]);e.valueOf=u.Number.valueOf;setTimeout(function(){if(t&&typeof t.then==="function"){t.then(e.fulfill,e.reject)}else{e.fulfill(+t)}},0);return e}function S(t){}function w(t){var e=new r(new d["Object"]);e.valueOf=u.Object.valueOf;setTimeout(function(){if(t&&typeof t.then==="function"){t.then(e.fulfill,e.reject)}else{e.fulfill(t)}},0);return e}s={String:g,Array:b,Number:v,Boolean:S,Object:w};u={String:{charAt:String.prototype.charAt,concat:String.prototype.concat,indexOf:String.prototype.indexOf,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split,slice:String.prototype.slice,substr:String.prototype.substr,substring:String.prototype.substring,toLowerCase:String.prototype.toLowerCase,toUpperCase:String.prototype.toUpperCase,trim:String.prototype.trim,length:function x(){return this.length},toFloat:function N(){return parseFloat(this)},toInt:function j(t){return parseInt(this,t||10)},parse:function O(){var t;try{t=JSON.parse(this)}catch(e){return e}return t},valueOf:function A(){return"StringPromise"},get:function _(t){return this[t]},set:function k(t,e){this[t]=e;return this},"delete":function T(t){delete this[t];return this},keys:function J(){return Object.keys(this)},toJSON:function P(){return JSON.stringify(this)}},Array:{pop:Array.prototype.pop,push:Array.prototype.push,reverse:Array.prototype.reverse,shift:Array.prototype.shift,sort:Array.prototype.sort,splice:Array.prototype.splice,unshift:Array.prototype.unshift,concat:Array.prototype.concat,join:Array.prototype.join,slice:Array.prototype.slice,toString:Array.prototype.toString,indexOf:Array.prototype.indexOf,lastIndexOf:Array.prototype.lastIndexOf,valueOf:function A(){return"ArrayPromise"},get:function _(t){return this[t]},set:function k(t,e){this[t]=e;return this},"delete":function T(t){delete this[t];return this},keys:function J(){return Object.keys(this)},toJSON:function P(){return JSON.stringify(this)}},Number:{toFixed:Number.prototype.toFixed,toPrecision:Number.prototype.toPrecision,toLocaleString:Number.prototype.toLocaleString,toString:Number.prototype.toString,toExponential:Number.prototype.toExponential,valueOf:function A(){return"NumberPromise"},plus:function C(){var t=+this,e=arguments.length;while(e--){t+=arguments[e]}return t},minus:function q(){var t=+this,e=arguments.length;while(e--){t-=arguments[e]}return t},times:function E(){var t=+this,e=arguments.length;while(e--){t*=arguments[e]}return t},divideBy:function F(){var t=+this,e=arguments.length;while(e--){t/=arguments[e]}return t},round:function I(){return Math.round(+this)},ceil:function M(){return Math.ceil(+this)},floor:function H(){return Math.floor(+this)},average:function L(){var t=+this,e=0,n=arguments.length;while(e<n){t+=arguments[e];e++}return t/(n+1)},modulus:function D(t){return+this%t},pow:function U(t){return Math.pow(+this,t)},abs:function B(){return Math.abs(+this)},max:function R(){return Math.max.apply(Math,Array.prototype.slice.call(arguments).concat(+this))},min:function z(){return Math.min.apply(Math,Array.prototype.slice.call(arguments).concat(+this))},get:function _(t){return this[t]},set:function k(t,e){this[t]=e;return this},"delete":function T(t){delete this[t];return this},keys:function J(){return Object.keys(this)},toJSON:function P(){return JSON.stringify(this)}},Object:{get:function _(t){return this[t]},set:function k(t,e){this[t]=e;return this},"delete":function T(t){delete this[t];return this},keys:function J(){return Object.keys(this)},valueOf:function A(){return"ObjectPromise"},toString:function G(){return this.toString()},toNumber:function K(){return+this},toArray:function Q(){return[this]},toJSON:function P(){return JSON.stringify(this)}}};l=u.String;l.parseFloat=l.toFloat;l.parseInt=l.toInt;l.json=l.toJSON;l=u.Number;l.raiseTo=l.power=l.pow;l.add=l.plus;l.subtract=l.minus;l.multiply=l.times;l.divide=l.divideBy;l.mean=l.average;l.json=l.toJSON;l=u.Array;l.json=l.toJSON;l=u.Object;l.json=l.toJSON;o={String:[["charAt","String"],["concat","String"],["indexOf","Number"],["length","Number"],["match","Array"],["replace","String"],["split","Array"],["slice","String"],["substr","String"],["substring","String"],["toLowerCase","String"],["toUpperCase","String"],["trim","String"],["toInt","Number"],["toFloat","Number"],["parseInt","Number"],["parseFloat","Number"],["get","Object"],["set","String"],["delete","String"],["keys","Array"],["parse","Object"],["toJSON","String"],["json","String"]],Array:[["pop","Object"],["push","Number"],["reverse","Array"],["shift","Object"],["sort","Array"],["splice","Array"],["unshift","Number"],["concat","Array"],["join","String"],["slice","Array"],["toString","String"],["indexOf","Number"],["lastIndexOf","Number"],["get","Object"],["set","Array"],["delete","Array"],["keys","Array"],["toJSON","String"],["json","String"]],Number:[["toFixed","String"],["toExponential","String"],["toLocaleString","String"],["toPrecision","String"],["toString","String"],["plus","Number"],["add","Number"],["minus","Number"],["subtract","Number"],["times","Number"],["multiply","Number"],["divideBy","Number"],["divide","Number"],["round","Number"],["ceil","Number"],["floor","Number"],["average","Number"],["modulus","Number"],["pow","Number"],["raiseTo","Number"],["power","Number"],["abs","Number"],["min","Number"],["max","Number"],["get","Object"],["set","Number"],["delete","Number"],["keys","Array"],["toJSON","String"],["json","String"]],Object:[["toString","String"],["toNumber","Number"],["toArray","Array"],["toJSON","String"],["json","String"],["get","Object"],["set","Object"],["delete","Object"],["keys","Array"]]};for(f in o){if(o.hasOwnProperty(f)){a=o[f];c=h[f]={};d[f]=function(){};d[f].prototype=c;m=a.length;while(m--){y=a[m][0];p=s[a[m][1]];l=u[f];c[y]=function V(t,e,n){return function s(){var s=new r,o=t(s),u=Array.prototype.slice.call(arguments);function l(t){var r;if(typeof t==="undefined"||t===null||typeof n[e]==="undefined"){return void s.reject(new TypeError("Promise result "+t+" has no property "+e))}if(typeof n[e]==="function"){u.unshift(function o(){var r;r=n[e].apply(t,Array.prototype.slice.call(arguments,0,-1));s.fulfill(r)});r=new i;r.and.apply(r,u);r.otherwise(s.reject)}else if(typeof t[e]!=="undefined"){return void s.fulfill(t[e])}}s.then(o.fulfill,o.reject);this.then(l,o.reject);return o}}(p,y,l)}}}e.exports={toString:g,toNumber:v,toArray:b,toObject:w}},{"./Promise":3,"./Chain":2}],6:[function(t,e,n){function r(){this.complete=false;this.results=[];this.complete_count=0;this.then=null;this.handler=null;this.assertion=null;this.condition=false;this.condition_value=null;this.condition_bound=false}r.prototype=[];e.exports=r},{}],8:[function(t,e,n){function r(t){var e=0,n=t.length;while(e<n){if(t[e].fulfilled===true){return t[e].result}e++}return null}function i(t){return t.assertion===null&&t.then===null&&t.length===0}function s(t){t=t[t.length-1];if(!t.start){return 0}else{return(t.finish||Date.now())-t.start}}function o(t){var e=t.length,n=0,r;while(e--){r=s(t[e]);if(r>n){n=r}}return n}e.exports={get_slice_result:r,check_step:i,get_item_time:s,find_max_time:o}},{}],7:[function(t,e,n){var r=t("./Promise");function i(t){function e(e){var n=new r;function i(t){var r;if(t){if(typeof e==="undefined"){r=t}else{r=t[e]}}else{r=null}return void n.fulfill(r)}function s(t){return void n.reject(t)}t.then(i,s);return n}return e}e.exports=i},{"./Promise":3}]},{},[1]);